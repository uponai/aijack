{% extends 'base.html' %}
{% load robot_extras %}

{% block title %}AI Robot Specification Matrix - Compare All Robots | AIJACK{% endblock %}
{% block meta_description %}Full specification comparison matrix of all AI robots. Sortable table for easy comparison.{% endblock %}

{% block content %}
<section class="py-8">
    <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">

        <!-- Header -->
        <div class="text-center mb-8">
            <a href="{% url 'robots' %}" class="text-cyan-600 hover:underline text-sm font-semibold">
                <i class="fa-solid fa-arrow-left mr-1"></i> Back to Robots
            </a>
            <h1 class="text-3xl md:text-4xl font-heading font-black text-slate-900 mt-4 mb-3">
                Specification <span class="text-cyan-600">MATRIX</span>
            </h1>
            <p class="text-slate-600">Click column headers to sort</p>
        </div>

        <!-- Matrix Table -->
        <div class="bg-white rounded-xl border border-slate-200 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full" id="robotMatrix">
                    <thead class="bg-slate-900 text-white">
                        <tr>
                            <th class="text-left p-4 sticky left-0 bg-slate-900 z-10">
                                <span class="font-heading font-bold">Robot</span>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(1)">
                                Company <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(2)">
                                Type <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(3)">
                                Market <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(4)">
                                Availability <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(5)">
                                Price <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(6)">
                                Height <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(7)">
                                Weight <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                            <th class="p-4 cursor-pointer hover:bg-slate-800" onclick="sortTable(8)">
                                Battery <i class="fa-solid fa-sort text-slate-500 ml-1"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {% for robot in robots %}
                        <tr class="hover:bg-cyan-50 transition">
                            <td class="p-4 sticky left-0 bg-white z-10">
                                <a href="{% url 'robot_detail' robot.slug %}" class="flex items-center gap-3 group">
                                    {% if robot.image %}
                                    <img src="{{ robot.image.url }}" alt="{{ robot.name }}"
                                         class="w-10 h-10 rounded-lg object-cover" loading="lazy">
                                    {% else %}
                                    <div class="w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center">
                                        <i class="fa-solid fa-robot text-slate-400"></i>
                                    </div>
                                    {% endif %}
                                    <span class="font-semibold text-slate-900 group-hover:text-cyan-600">{{ robot.name }}</span>
                                    {% if robot.is_featured %}
                                    <span class="text-xs text-amber-600"><i class="fa-solid fa-star"></i></span>
                                    {% endif %}
                                </a>
                            </td>
                            <td class="p-4 text-center">{{ robot.company.name }}</td>
                            <td class="p-4 text-center">
                                <span class="px-2 py-1 rounded text-xs font-semibold 
                                    {% if robot.robot_type == 'humanoid' %}bg-violet-100 text-violet-700{% else %}bg-amber-100 text-amber-700{% endif %}">
                                    {{ robot.get_robot_type_display }}
                                </span>
                            </td>
                            <td class="p-4 text-center text-sm">{{ robot.get_target_market_display }}</td>
                            <td class="p-4 text-center">
                                <span class="px-2 py-1 rounded text-xs font-semibold
                                    {% if robot.availability == 'available' %}bg-green-100 text-green-700
                                    {% elif robot.availability == 'preorder' %}bg-blue-100 text-blue-700
                                    {% else %}bg-slate-100 text-slate-600{% endif %}">
                                    {{ robot.get_availability_display }}
                                </span>
                            </td>
                            <td class="p-4 text-center font-mono text-cyan-600">
                                {% if robot.price_value %}
                                ${{ robot.price_value|floatformat:0 }}
                                {% else %}
                                {{ robot.get_pricing_tier_display }}
                                {% endif %}
                            </td>
                            <td class="p-4 text-center font-mono text-sm">{{ robot.specifications|get_spec:"height" }}</td>
                            <td class="p-4 text-center font-mono text-sm">{{ robot.specifications|get_spec:"weight" }}</td>
                            <td class="p-4 text-center font-mono text-sm">{{ robot.specifications|get_spec:"battery_life" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="9" class="p-8 text-center text-slate-500">No robots available</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>

<script>
    let sortDirection = {};

    function sortTable ( columnIndex )
    {
        const table = document.getElementById( 'robotMatrix' );
        const tbody = table.querySelector( 'tbody' );
        const rows = Array.from( tbody.querySelectorAll( 'tr' ) );

        sortDirection[ columnIndex ] = !sortDirection[ columnIndex ];
        const ascending = sortDirection[ columnIndex ];

        rows.sort( ( a, b ) =>
        {
            const aText = a.cells[ columnIndex ]?.textContent.trim() || '';
            const bText = b.cells[ columnIndex ]?.textContent.trim() || '';

            // Try numeric sort
            const aNum = parseFloat( aText.replace( /[^0-9.-]/g, '' ) );
            const bNum = parseFloat( bText.replace( /[^0-9.-]/g, '' ) );

            if ( !isNaN( aNum ) && !isNaN( bNum ) )
            {
                return ascending ? aNum - bNum : bNum - aNum;
            }

            return ascending ? aText.localeCompare( bText ) : bText.localeCompare( aText );
        } );

        rows.forEach( row => tbody.appendChild( row ) );
    }
</script>
{% endblock %}