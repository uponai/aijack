{# Robot Card Partial - Cyan Theme #}
{% load robot_extras %}

<div class="group relative h-full">
    <a href="{% url 'robot_detail' robot.slug %}" class="robot-card block h-full bg-white rounded-2xl border border-slate-200 p-5 hover:border-cyan-400 hover:shadow-lg hover:shadow-cyan-100/50 transition-all duration-300">

        <!-- Robot Image -->
        <div class="relative mb-4 rounded-xl overflow-hidden bg-gradient-to-br from-slate-100 to-slate-50 aspect-square">
            {% if robot.image %}
            <img src="{{ robot.image.url }}"
                 alt="{{ robot.name }} - {{ robot.get_robot_type_display }} robot by {{ robot.company.name }}"
                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                 loading="lazy">
            {% else %}
            <!-- Placeholder with Robot Icon -->
            <div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-slate-800 to-slate-900">
                <i class="fa-solid fa-robot text-6xl text-cyan-500 opacity-50"></i>
            </div>
            {% endif %}

            <!-- Type Badge -->
            <div class="absolute top-3 left-3">
                <span class="px-2 py-1 rounded-full text-xs font-bold uppercase tracking-wider 
                    {% if robot.robot_type == 'humanoid' %}bg-violet-100 text-violet-700{% else %}bg-amber-100 text-amber-700{% endif %}">
                    {{ robot.get_robot_type_display }}
                </span>
            </div>

            <!-- Availability Badge -->
            <div class="absolute top-3 right-3">
                <span class="px-2 py-1 rounded-full text-xs font-bold uppercase tracking-wider
                    {% if robot.availability == 'available' %}bg-green-100 text-green-700
                    {% elif robot.availability == 'preorder' %}bg-blue-100 text-blue-700
                    {% elif robot.availability == 'announced' %}bg-yellow-100 text-yellow-700
                    {% elif robot.availability == 'development' %}bg-orange-100 text-orange-700
                    {% elif robot.availability == 'discontinued' %}bg-red-100 text-red-700
                    {% else %}bg-slate-100 text-slate-600{% endif %}">
                    {{ robot.get_availability_display }}
                </span>
            </div>

            <!-- Add to Compare Button (on hover) -->
            <div class="absolute bottom-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity">
                {% is_in_comparison request robot.id as in_comparison %}
                <button onclick="event.preventDefault(); toggleComparison({{ robot.id }}, '{{ robot.name }}')"
                        class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold transition
                        {% if in_comparison %}bg-cyan-600 text-white{% else %}bg-white/90 text-slate-600 hover:bg-cyan-600 hover:text-white{% endif %}"
                        title="{% if in_comparison %}Remove from comparison{% else %}Add to comparison{% endif %}">
                    <i class="fa-solid fa-code-compare"></i>
                </button>
            </div>
        </div>

        <!-- Company Tag -->
        <div class="flex items-center gap-2 mb-2">
            <i class="fa-solid fa-building text-slate-400 text-xs"></i>
            <span class="text-xs font-semibold text-slate-500 uppercase tracking-wider">{{ robot.company.name }}</span>
        </div>

        <!-- Robot Name -->
        <h3 class="font-heading font-bold text-xl text-slate-900 mb-2 group-hover:text-cyan-600 transition-colors line-clamp-1">
            {{ robot.name }}
        </h3>

        <!-- Short Description -->
        <p class="text-slate-600 text-sm mb-4 line-clamp-2">{{ robot.short_description }}</p>

        <!-- Meta Info -->
        <div class="flex items-center justify-between pt-4 border-t border-slate-100">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-crosshairs text-cyan-500 text-xs"></i>
                <span class="text-xs text-slate-500">{{ robot.get_target_market_display }}</span>
            </div>
            {% if robot.release_date %}
            <span class="text-xs text-slate-400">
                <i class="fa-solid fa-calendar mr-1"></i>
                {{ robot.release_date|date:"M Y" }}
            </span>
            {% endif %}
        </div>

        <!-- Featured Badge -->
        {% if robot.is_featured %}
        <div class="absolute -top-2 -right-2 z-10">
            {% include 'includes/_featured_badge.html' %}
        </div>
        {% endif %}
    </a>
</div>

<script>
    function toggleComparison ( robotId, robotName )
    {
        fetch( `/api/robots/comparison/add/?robot_id=${ robotId }` )
            .then( r => r.json() )
            .then( data =>
            {
                if ( data.success )
                {
                    // Update UI or show notification
                    location.reload();
                } else if ( data.error )
                {
                    alert( data.error );
                }
            } );
    }
</script>